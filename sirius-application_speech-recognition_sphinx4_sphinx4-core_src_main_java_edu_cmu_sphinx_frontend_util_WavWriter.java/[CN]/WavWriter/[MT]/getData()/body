{
  Data data=getPredecessor().getData();
  if (data instanceof DataStartSignal)   sampleRate=((DataStartSignal)data).getSampleRate();
  if (data instanceof DataStartSignal || (data instanceof SpeechStartSignal && captureUtts)) {
    baos=new ByteArrayOutputStream();
    dos=new DataOutputStream(baos);
  }
  if ((data instanceof DataEndSignal && !captureUtts) || (data instanceof SpeechEndSignal && captureUtts)) {
    String wavName;
    if (isCompletePath)     wavName=outFileNamePattern;
 else     wavName=getNextFreeIndex(outFileNamePattern);
    writeFile(wavName);
    isInSpeech=false;
  }
  if (data instanceof SpeechStartSignal)   isInSpeech=true;
  if ((data instanceof DoubleData || data instanceof FloatData) && (isInSpeech || !captureUtts)) {
    DoubleData dd=data instanceof DoubleData ? (DoubleData)data : DataUtil.FloatData2DoubleData((FloatData)data);
    double[] values=dd.getValues();
    for (    double value : values) {
      try {
        dos.writeShort(new Short((short)value));
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
    }
  }
  return data;
}
