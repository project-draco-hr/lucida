{
  byte[] buf=writeBuffer.get();
  int dataLength=writeBuffer.len();
  writeBuffer.reset();
  if (shouldWrap) {
    LOGGER.debug("data length before wrap: {}",dataLength);
    try {
      buf=sasl.wrap(buf,0,dataLength);
    }
 catch (    SaslException e) {
      throw new TTransportException(e);
    }
    dataLength=buf.length;
  }
  LOGGER.debug("writing data length: {}",dataLength);
  writeLength(dataLength);
  underlyingTransport.write(buf,0,dataLength);
  underlyingTransport.flush();
}
