{
  DataInputStream in=new DataInputStream(new FileInputStream(filename));
  if (in.readInt() != SMEAR_MAGIC) {
    in.close();
    throw new IOException("Bad smear format for " + filename);
  }
  if (in.readInt() != unigrams.length) {
    in.close();
    throw new IOException("Bad unigram length in " + filename);
  }
  bigramSmearMap=new HashMap<Long,Float>();
  unigramSmearTerm=new float[unigrams.length];
  System.out.println("Reading " + unigrams.length);
  for (int i=0; i < unigrams.length; i++)   unigramSmearTerm[i]=in.readFloat();
  for (int i=0; i < unigrams.length; i++) {
    System.out.println("Processed " + i + " of "+ loadedBigramBuffers.length);
    int numBigrams=in.readInt();
    NGramBuffer bigram=getBigramBuffer(i);
    if (bigram.getNumberNGrams() != numBigrams) {
      in.close();
      throw new IOException("Bad ngrams for unigram " + i + " Found "+ numBigrams+ " expected "+ bigram.getNumberNGrams());
    }
    for (int j=0; j < numBigrams; j++) {
      int k=bigram.getWordID(j);
      putSmearTerm(i,k,in.readFloat());
    }
  }
  in.close();
}
