{
  int length=input.length;
  double[] signal=new double[length];
  for (int i=0; i < length; i++) {
    double max=Math.max(smoothedInput[i] - noise[i],0);
    double s=gamma * prevSignal[i] + (1 - gamma) * max;
    double eta=Math.max(s / noise[i],etaMin);
    signal[i]=eta / (1 + eta) * input[i];
  }
  return signal;
}
