{
  double nextPrior=prior;
  if (in.length > 0) {
    nextPrior=in[in.length - 1];
  }
  if (in.length > 1 && preemphasisFactor != 0.0) {
    double current;
    double previous=in[0];
    in[0]=previous - preemphasisFactor * prior;
    for (int i=1; i < in.length; i++) {
      current=in[i];
      in[i]=current - preemphasisFactor * previous;
      previous=current;
    }
  }
  prior=nextPrior;
}
