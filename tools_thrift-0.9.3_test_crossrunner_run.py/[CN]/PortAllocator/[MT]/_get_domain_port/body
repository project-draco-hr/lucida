def _get_domain_port(self):
    port = random.randint(1024, 65536)
    self._lock.acquire()
    try:
        ok = (port not in self._dom_ports)
        if ok:
            self._dom_ports.add(port)
    finally:
        self._lock.release()
    return (port if ok else self._get_domain_port())
