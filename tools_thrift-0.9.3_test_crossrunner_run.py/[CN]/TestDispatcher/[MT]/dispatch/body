def dispatch(self, test):
    index = self._report.add_test(test)

    def cont(r):
        if (not self._stop.is_set()):
            self._log.debug('freeing port')
            self._log.debug('adding result')
            self._report.add_result(index, r, (r == RESULT_TIMEOUT))
            self._log.debug('finish continuation')
    fn = (self._dispatch_async if self._async else self._dispatch_sync)
    return fn(test, cont)
