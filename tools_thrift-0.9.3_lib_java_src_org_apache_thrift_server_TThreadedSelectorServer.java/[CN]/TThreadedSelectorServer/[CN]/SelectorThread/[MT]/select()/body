{
  try {
    selector.select();
    Iterator<SelectionKey> selectedKeys=selector.selectedKeys().iterator();
    while (!stopped_ && selectedKeys.hasNext()) {
      SelectionKey key=selectedKeys.next();
      selectedKeys.remove();
      if (!key.isValid()) {
        cleanupSelectionKey(key);
        continue;
      }
      if (key.isReadable()) {
        handleRead(key);
      }
 else       if (key.isWritable()) {
        handleWrite(key);
      }
 else {
        LOGGER.warn("Unexpected state in select! " + key.interestOps());
      }
    }
  }
 catch (  IOException e) {
    LOGGER.warn("Got an IOException while selecting!",e);
  }
}
