{
  SaslClient saslClient=getSaslClient();
  byte[] initialResponse=new byte[0];
  if (saslClient.hasInitialResponse())   initialResponse=saslClient.evaluateChallenge(initialResponse);
  LOGGER.debug("Sending mechanism name {} and initial response of length {}",mechanism,initialResponse.length);
  byte[] mechanismBytes=mechanism.getBytes();
  sendSaslMessage(NegotiationStatus.START,mechanismBytes);
  sendSaslMessage(saslClient.isComplete() ? NegotiationStatus.COMPLETE : NegotiationStatus.OK,initialResponse);
  underlyingTransport.flush();
}
