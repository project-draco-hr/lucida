{
  int lastComparison=compareTo(a.size(),b.size());
  if (lastComparison != 0) {
    return lastComparison;
  }
  SortedMap sortedA=new TreeMap(comparator);
  sortedA.putAll(a);
  Iterator<Map.Entry> iterA=sortedA.entrySet().iterator();
  SortedMap sortedB=new TreeMap(comparator);
  sortedB.putAll(b);
  Iterator<Map.Entry> iterB=sortedB.entrySet().iterator();
  while (iterA.hasNext() && iterB.hasNext()) {
    Map.Entry entryA=iterA.next();
    Map.Entry entryB=iterB.next();
    lastComparison=comparator.compare(entryA.getKey(),entryB.getKey());
    if (lastComparison != 0) {
      return lastComparison;
    }
    lastComparison=comparator.compare(entryA.getValue(),entryB.getValue());
    if (lastComparison != 0) {
      return lastComparison;
    }
  }
  return 0;
}
