{
  assert(samples.length % channels == 0);
  double[] finalSamples=new double[samples.length / channels];
  if (stereoToMono.equals("average")) {
    for (int i=0, j=0; i < samples.length; j++) {
      double sum=samples[i++];
      for (int c=1; c < channels; c++) {
        sum+=samples[i++];
      }
      finalSamples[j]=sum / channels;
    }
  }
 else   if (stereoToMono.equals("selectChannel")) {
    for (int i=selectedChannel, j=0; i < samples.length; i+=channels, j++) {
      finalSamples[j]=samples[i];
    }
  }
 else {
    throw new Error("Unsupported stereo to mono conversion: " + stereoToMono);
  }
  return finalSamples;
}
