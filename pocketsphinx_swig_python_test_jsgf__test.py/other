from itertools import izip
from os import environ, path
from sys import stdout
from pocketsphinx import *
from sphinxbase import *
MODELDIR = '../../../model'
DATADIR = '../../../test/data'
config = Decoder.default_config()
config.set_string('-hmm', path.join(MODELDIR, 'hmm/en_US/hub4wsj_sc_8k'))
config.set_string('-lm', path.join(MODELDIR, 'lm/en/turtle.DMP'))
config.set_string('-dict', path.join(MODELDIR, 'lm/en/turtle.dic'))
decoder = Decoder(config)
decoder.decode_raw(open(path.join(DATADIR, 'goforward.raw'), 'rb'))
print 'Decoding with "turtle" language:', decoder.hyp().hypstr
jsgf = Jsgf(path.join(DATADIR, 'goforward.gram'))
rule = jsgf.get_rule('<goforward.move2>')
fsg = jsgf.build_fsg(rule, decoder.get_logmath(), 7.5)
fsg.write(stdout)
fsg.writefile('goforward.fsg')
decoder.set_fsg('goforward', fsg)
decoder.set_search('goforward')
decoder.decode_raw(open(path.join(DATADIR, 'goforward.raw'), 'rb'))
print 'Decoding with "goforward" grammar:', decoder.hyp().hypstr
