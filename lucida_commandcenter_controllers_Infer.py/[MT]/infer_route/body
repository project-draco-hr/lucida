@infer.route('/infer', methods=['GET', 'POST'])
@login_required
def infer_route():
    result = None
    try:
        if (request.method == 'POST'):
            form = request.form
            if (not ('op' in form)):
                raise RuntimeError('Did you click the Ask button?')
            elif (form['op'] == 'infer'):
                check_image_extension(request.files['file'])
                check_text_input(form['speech_input'])
                services_needed = query_classifier.predict(form['speech_input'], request.files['file'])
                result = thrift_client.infer(session['username'], services_needed, form['speech_input'], request.files['file'].read())
                log(('Result ' + result))
                if (services_needed == ['CA']):
                    return render_template('infer.html', dates=result)
            else:
                raise RuntimeError('Did you click the Ask button?')
    except Exception as e:
        log(e)
        return render_template('infer.html', error=e)
    return render_template('infer.html', result=result)
