def setUp(self):
    super(ThriftTestCase, self).setUp()
    self.port = get_unused_port()
    self.handler = TestHandler(self)
    self.processor = ThriftTest.Processor(self.handler)
    self.pfactory = TBinaryProtocol.TBinaryProtocolFactory()
    self.server = TTornado.TTornadoServer(self.processor, self.pfactory, io_loop=self.io_loop)
    self.server.bind(self.port)
    self.server.start(1)
    transport = TTornado.TTornadoStreamTransport('localhost', self.port, io_loop=self.io_loop)
    pfactory = TBinaryProtocol.TBinaryProtocolFactory()
    self.io_loop.run_sync(transport.open)
    self.client = ThriftTest.Client(transport, pfactory)
