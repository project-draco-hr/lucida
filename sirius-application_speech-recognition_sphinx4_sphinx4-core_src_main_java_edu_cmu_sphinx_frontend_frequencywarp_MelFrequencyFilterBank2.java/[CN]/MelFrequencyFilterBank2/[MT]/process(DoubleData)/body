{
  double[] in=input.getValues();
  int windowLength=(in.length - 1) << 1;
  if (filters == null || sampleRate != input.getSampleRate()) {
    sampleRate=input.getSampleRate();
    buildFilterbank(windowLength,numberFilters,minFreq,maxFreq);
  }
 else   if (in.length != ((windowLength >> 1) + 1)) {
    throw new IllegalArgumentException("Window size is incorrect: in.length == " + in.length + ", numberFftPoints == "+ ((windowLength >> 1) + 1));
  }
  double[] output=new double[numberFilters];
  for (int i=0; i < numberFilters; i++)   output[i]=filters[i].apply(in);
  DoubleData outputMelSpectrum=new DoubleData(output,sampleRate,input.getFirstSampleNumber());
  return outputMelSpectrum;
}
