def __withTimeout(f):

    def _f(*args, **kwargs):
        orig_timeout = socket.getdefaulttimeout()
        socket.setdefaulttimeout(args[0].__timeout)
        try:
            result = f(*args, **kwargs)
        finally:
            socket.setdefaulttimeout(orig_timeout)
        return result
    return _f
