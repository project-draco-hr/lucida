def flush(self):
    if self.isOpen():
        self.close()
    self.open()
    data = self.__wbuf.getvalue()
    self.__wbuf = StringIO()
    self.__http.putrequest('POST', self.path)
    self.__http.putheader('Host', self.host)
    self.__http.putheader('Content-Type', 'application/x-thrift')
    self.__http.putheader('Content-Length', str(len(data)))
    if ((not self.__custom_headers) or ('User-Agent' not in self.__custom_headers)):
        user_agent = 'Python/THttpClient'
        script = os.path.basename(sys.argv[0])
        if script:
            user_agent = ('%s (%s)' % (user_agent, urllib.quote(script)))
        self.__http.putheader('User-Agent', user_agent)
    if self.__custom_headers:
        for (key, val) in self.__custom_headers.iteritems():
            self.__http.putheader(key, val)
    self.__http.endheaders()
    self.__http.send(data)
    (self.code, self.message, self.headers) = self.__http.getreply()
