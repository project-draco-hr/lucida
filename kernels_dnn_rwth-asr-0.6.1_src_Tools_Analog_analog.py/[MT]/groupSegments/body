def groupSegments(segments, groupBy):
    groups = {}
    keys = set()
    for id in segments:
        g = groupBy(segments[id])
        if (g not in groups):
            groups[g] = []
        groups[g].append(id)
        for k in segments[id].keys():
            keys.add(k)
    return dict([(g, dict([(k, [segments[id][k] for id in groups[g]]) for k in keys])) for g in groups])
