def _call_ratios_cycle(self, cycle, function, ranks, call_ratios, visited):
    if (function not in visited):
        visited.add(function)
        for call in compat_itervalues(function.calls):
            if (call.callee_id != function.id):
                callee = self.functions[call.callee_id]
                if (callee.cycle is cycle):
                    if (ranks[callee] > ranks[function]):
                        call_ratios[callee] = (call_ratios.get(callee, 0.0) + call.ratio)
                        self._call_ratios_cycle(cycle, callee, ranks, call_ratios, visited)
