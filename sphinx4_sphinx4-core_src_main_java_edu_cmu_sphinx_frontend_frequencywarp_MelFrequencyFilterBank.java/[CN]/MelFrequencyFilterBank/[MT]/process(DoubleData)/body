{
  double[] in=input.getValues();
  if (filter == null || sampleRate != input.getSampleRate()) {
    numberFftPoints=(in.length - 1) << 1;
    sampleRate=input.getSampleRate();
    buildFilterbank(numberFftPoints,numberFilters,minFreq,maxFreq);
  }
 else   if (in.length != ((numberFftPoints >> 1) + 1)) {
    throw new IllegalArgumentException("Window size is incorrect: in.length == " + in.length + ", numberFftPoints == "+ ((numberFftPoints >> 1) + 1));
  }
  double[] output=new double[numberFilters];
  for (int i=0; i < numberFilters; i++) {
    output[i]=filter[i].filterOutput(in);
  }
  DoubleData outputMelSpectrum=new DoubleData(output,sampleRate,input.getFirstSampleNumber());
  return outputMelSpectrum;
}
