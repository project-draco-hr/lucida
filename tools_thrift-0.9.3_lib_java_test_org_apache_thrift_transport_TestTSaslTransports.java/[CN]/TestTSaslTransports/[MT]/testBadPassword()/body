{
  ServerThread serverThread=new ServerThread(UNWRAPPED_MECHANISM,UNWRAPPED_PROPS);
  serverThread.start();
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException e) {
  }
  boolean clientSidePassed=true;
  try {
    TSocket clientSocket=new TSocket(HOST,ServerTestBase.PORT);
    TTransport saslClientTransport=new TSaslClientTransport(UNWRAPPED_MECHANISM,PRINCIPAL,SERVICE,HOST,UNWRAPPED_PROPS,new TestSaslCallbackHandler("NOT THE PASSWORD"),clientSocket);
    saslClientTransport.open();
    clientSidePassed=false;
    fail("Was able to open transport with bad password");
  }
 catch (  TTransportException tte) {
    LOGGER.error("Exception for bad password",tte);
    assertNotNull(tte.getMessage());
    assertTrue(tte.getMessage().contains("Invalid response"));
  }
 finally {
    serverThread.interrupt();
    serverThread.join();
    if (clientSidePassed) {
      assertNotNull(serverThread.thrown);
      assertTrue(serverThread.thrown.getMessage().contains("Invalid response"));
    }
  }
}
