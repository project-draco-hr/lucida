def writeContainerMap(self, val, spec):
    k_type = spec[0]
    v_type = spec[2]
    (ignore, ktype_name, k_is_container) = self._TTYPE_HANDLERS[k_type]
    (ignore, vtype_name, v_is_container) = self._TTYPE_HANDLERS[v_type]
    k_writer = getattr(self, ktype_name)
    v_writer = getattr(self, vtype_name)
    self.writeMapBegin(k_type, v_type, len(val))
    for (m_key, m_val) in val.iteritems():
        if (not k_is_container):
            k_writer(m_key)
        else:
            k_writer(m_key, spec[1])
        if (not v_is_container):
            v_writer(m_val)
        else:
            v_writer(m_val, spec[3])
    self.writeMapEnd()
