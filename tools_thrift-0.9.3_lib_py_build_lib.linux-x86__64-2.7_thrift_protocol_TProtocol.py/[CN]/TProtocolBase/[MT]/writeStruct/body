def writeStruct(self, obj, thrift_spec):
    self.writeStructBegin(obj.__class__.__name__)
    for field in thrift_spec:
        if (field is None):
            continue
        fname = field[2]
        val = getattr(obj, fname)
        if (val is None):
            continue
        fid = field[0]
        ftype = field[1]
        fspec = field[3]
        self.writeFieldBegin(fname, ftype, fid)
        self.writeFieldByTType(ftype, val, fspec)
        self.writeFieldEnd()
    self.writeFieldStop()
    self.writeStructEnd()
