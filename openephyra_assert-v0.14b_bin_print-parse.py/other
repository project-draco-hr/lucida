import string
import sys
import re
if ((len(sys.argv) == 1) or (len(sys.argv) != 3)):
    print 'Usage: print-parse.py <svm-scores-file> <sentence-file>'
    sys.exit(1)
score_file_lines = open(sys.argv[1]).readlines()
list_of_start_arrays = []
list_of_end_arrays = []
list_of_role_arrays = []
list_of_target_indices = []
list_of_word_lists = []
start_array = []
end_array = []
role_array = []
word_list = []
some_list = string.split(score_file_lines[0])
i = (len(some_list) - 1)
start_score_index = (len(some_list) - 1)
hyp_index = (len(some_list) - 1)
ref_index = (len(some_list) - 1)
while (i > 0):
    if (len(re.findall('/', some_list[i])) == 1):
        hyp_index = (hyp_index - 1)
        start_score_index = (hyp_index + 1)
        ref_index = (hyp_index - 1)
    else:
        break
    i = (i - 1)
i = 0
for i in range(0, len(score_file_lines)):
    if (len(string.strip(score_file_lines[i])) == 0):
        list_of_start_arrays.append(start_array)
        list_of_end_arrays.append(end_array)
        list_of_role_arrays.append(role_array)
        list_of_target_indices.append(target_index)
        start_array = []
        end_array = []
        role_array = []
        continue
    list = string.split(score_file_lines[i])
    start_array.append(string.atoi(list[2]))
    end_array.append(string.atoi(list[3]))
    role_array.append(list[hyp_index])
    target_index = string.atoi(list[1])
list_of_word_lists = open(sys.argv[2]).readlines()
kk = 0
for kk in range(0, len(list_of_word_lists)):
    list_of_word_lists[kk] = string.split(list_of_word_lists[kk])
jj = 0
for jj in range(0, len(list_of_start_arrays)):
    word_list_copy = list_of_word_lists[jj]
    word_list_copy[list_of_target_indices[jj]] = ('<font color="#FF6666">[<sub>target</sub> <i>%s ' % word_list_copy[list_of_target_indices[jj]])
    word_list_copy[list_of_target_indices[jj]] = ('%s</i> ]</font>' % word_list_copy[list_of_target_indices[jj]])
    j = 0
    for j in range(0, len(list_of_start_arrays[jj])):
        if (list_of_role_arrays[jj][j] == 'O'):
            continue
        try:
            word_list_copy[list_of_start_arrays[jj][j]] = ('<font color="#FF6666">[<sub>%s</sub></font> <i><font color="#3333FF">%s' % (string.lower(list_of_role_arrays[jj][j]), word_list_copy[list_of_start_arrays[jj][j]]))
            word_list_copy[list_of_end_arrays[jj][j]] = ('%s</font></i><font color="#FF6666">]</font>' % word_list_copy[list_of_end_arrays[jj][j]])
        except:
            print  >> sys.stderr, 'got some-problem skipping'
    parse = string.join(word_list_copy)
    parse = re.sub('-LAB-', '&lt;', parse)
    parse = re.sub('-RAB-', '&gt;', parse)
    parse = re.sub('-LCB-', '{', parse)
    parse = re.sub('-RCB-', '}', parse)
    parse = re.sub('-LRB-', '(', parse)
    parse = re.sub('-RRB-', ')', parse)
    print parse
    print '<hr>'
