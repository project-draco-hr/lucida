{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DeflaterOutputStream deflaterOutputStream=new DeflaterOutputStream(baos);
  DataOutputStream dos=new DataOutputStream(deflaterOutputStream);
  dos.write(byteSequence(0,49));
  dos.write(byteSequence(0,219));
  deflaterOutputStream.finish();
  TMemoryBuffer membuf=new TMemoryBuffer(0);
  membuf.write(baos.toByteArray());
  ReadCountingTransport countTrans=new ReadCountingTransport(membuf);
  TTransport trans=getTransport(countTrans);
  byte[] readBuf=new byte[10];
  trans.read(readBuf,0,10);
  assertTrue(Arrays.equals(readBuf,byteSequence(0,9)));
  assertEquals(1,countTrans.readCount);
  trans.read(readBuf,0,10);
  assertTrue(Arrays.equals(readBuf,byteSequence(10,19)));
  assertEquals(1,countTrans.readCount);
  assertEquals(30,trans.read(new byte[30],0,30));
  assertEquals(1,countTrans.readCount);
  readBuf=new byte[220];
  assertEquals(220,trans.read(readBuf,0,220));
  assertTrue(Arrays.equals(readBuf,byteSequence(0,219)));
  assertEquals(1,countTrans.readCount);
}
