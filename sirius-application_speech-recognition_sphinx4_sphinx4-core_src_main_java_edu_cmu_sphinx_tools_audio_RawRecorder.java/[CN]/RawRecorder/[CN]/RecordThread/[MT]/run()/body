{
  byte[] data=new byte[microphone.getBufferSize()];
  out=new ByteArrayOutputStream();
  try {
    microphone.flush();
    microphone.start();
    while (!done) {
      int numBytesRead=microphone.read(data,0,data.length);
      if (numBytesRead != -1) {
        out.write(data,0,numBytesRead);
      }
 else {
        break;
      }
    }
    microphone.stop();
    out.flush();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
synchronized (lock) {
    lock.notify();
  }
}
