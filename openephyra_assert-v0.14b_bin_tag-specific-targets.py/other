import string
import re
import sys
if (len(sys.argv) != 6):
    print 'Usage: tag-specific-targets.py <pos_tagged_file> <target-list> <morph_file> <output_file> <line_index_list>'
    sys.exit(1)
input_file = open(sys.argv[1])
input_file_lines = input_file.readlines()
target_list_file = open(sys.argv[2])
target_list_file_lines = target_list_file.readlines()
morph_file_lines = open(sys.argv[3]).readlines()
output_file = open(sys.argv[4], 'w')
output_file_lines = []
line_index_list = []
line_index_file = open(sys.argv[5], 'w')
target_matcher = re.compile(' (?P<word>[^_][^_]*)_(?P<tag>V[^ ][^ ]*) ')
target_list_hash = {}
for verb in target_list_file_lines:
    target_list_hash[string.strip(verb)] = 1
morph_hash = {}
for line in morph_file_lines:
    list = string.split(line)
    if (len(list) == 2):
        (verb, morph_verb) = (list[0], list[1])
        morph_hash[verb] = morph_verb
target_list = []
i = 0
for line in input_file_lines:
    start_index = 0
    end_index = len(line)
    some_match = target_matcher.search(line, start_index, end_index)
    while (some_match != None):
        some_string = ('%s <C TARGET="y"> %s/%s </C> %s' % (line[0:some_match.span('word')[0]], line[some_match.span('word')[0]:some_match.span('word')[1]], line[some_match.span('tag')[0]:some_match.span('tag')[1]], line[some_match.span('tag')[1]:end_index]))
        word = line[some_match.span('word')[0]:some_match.span('word')[1]]
        if morph_hash.has_key(word):
            morph_word = morph_hash[word]
        else:
            morph_word = word
        if target_list_hash.has_key(morph_word):
            output_file_lines.append(some_string)
            line_index_list.append(('%d\n' % i))
            target_list.append(line[some_match.span('word')[0]:some_match.span('word')[1]])
        start_index = some_match.span('tag')[1]
        some_match = target_matcher.search(line, start_index, end_index)
    i = (i + 1)
i = 0
for i in range(0, len(output_file_lines)):
    output_file_lines[i] = re.sub('_', '/', output_file_lines[i])
    if morph_hash.has_key(target_list[i]):
        target_list[i] = morph_hash[target_list[i]]
    output_file_lines[i] = ('DOMAIN/FRAME/%s.v.ar:<S TPOS="%s"> %s </S>\n' % (target_list[i], string.zfill((i + 1000), 14), string.strip(output_file_lines[i])))
    output_file_lines[i] = re.sub('-SLASH-', '/', output_file_lines[i])
    output_file_lines[i] = re.sub('-UNDERSCORE-', '_', output_file_lines[i])
output_file.writelines(output_file_lines)
line_index_file.writelines(line_index_list)
