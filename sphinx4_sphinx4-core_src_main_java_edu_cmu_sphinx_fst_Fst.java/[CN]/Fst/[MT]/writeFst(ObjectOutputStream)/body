{
  writeStringMap(out,isyms);
  writeStringMap(out,osyms);
  out.writeInt(states.indexOf(start));
  out.writeObject(semiring);
  out.writeInt(states.size());
  HashMap<State,Integer> stateMap=new HashMap<State,Integer>(states.size(),1.f);
  for (int i=0; i < states.size(); i++) {
    State s=states.get(i);
    out.writeInt(s.getNumArcs());
    out.writeFloat(s.getFinalWeight());
    out.writeInt(s.getId());
    stateMap.put(s,i);
  }
  int numStates=states.size();
  for (int i=0; i < numStates; i++) {
    State s=states.get(i);
    int numArcs=s.getNumArcs();
    for (int j=0; j < numArcs; j++) {
      Arc a=s.getArc(j);
      out.writeInt(a.getIlabel());
      out.writeInt(a.getOlabel());
      out.writeFloat(a.getWeight());
      out.writeInt(stateMap.get(a.getNextState()));
    }
  }
}
