{
  if (!key.isValid()) {
    key.cancel();
    Exception e=new TTransportException("Selection key not valid!");
    onError(e);
    return;
  }
  try {
switch (state) {
case CONNECTING:
      doConnecting(key);
    break;
case WRITING_REQUEST_SIZE:
  doWritingRequestSize();
break;
case WRITING_REQUEST_BODY:
doWritingRequestBody(key);
break;
case READING_RESPONSE_SIZE:
doReadingResponseSize();
break;
case READING_RESPONSE_BODY:
doReadingResponseBody(key);
break;
default :
throw new IllegalStateException("Method call in state " + state + " but selector called transition method. Seems like a bug...");
}
}
 catch (Exception e) {
key.cancel();
key.attach(null);
onError(e);
}
}
