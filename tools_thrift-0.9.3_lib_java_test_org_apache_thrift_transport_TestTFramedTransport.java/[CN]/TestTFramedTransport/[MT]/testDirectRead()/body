{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputStream dos=new DataOutputStream(baos);
  dos.writeInt(50);
  dos.write(byteSequence(0,49));
  dos.writeInt(75);
  dos.write(byteSequence(125,200));
  TMemoryBuffer membuf=new TMemoryBuffer(0);
  membuf.write(baos.toByteArray());
  ReadCountingTransport countTrans=new ReadCountingTransport(membuf);
  TTransport trans=getTransport(countTrans);
  assertEquals(0,trans.getBytesRemainingInBuffer());
  byte[] readBuf=new byte[10];
  trans.read(readBuf,0,10);
  assertTrue(Arrays.equals(readBuf,byteSequence(0,9)));
  assertEquals(40,trans.getBytesRemainingInBuffer());
  assertEquals(10,trans.getBufferPosition());
  trans.consumeBuffer(5);
  assertEquals(35,trans.getBytesRemainingInBuffer());
  assertEquals(15,trans.getBufferPosition());
  assertEquals(2,countTrans.readCount);
  assertEquals(35,trans.read(new byte[35],0,35));
  assertEquals(0,trans.getBytesRemainingInBuffer());
  assertEquals(50,trans.getBufferPosition());
  trans.read(readBuf,0,10);
  assertEquals(4,countTrans.readCount);
  assertTrue(Arrays.equals(readBuf,byteSequence(125,134)));
  assertEquals(65,trans.getBytesRemainingInBuffer());
  assertEquals(10,trans.getBufferPosition());
}
